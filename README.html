<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />
<meta name="viewport" content="width=device-width, initial-scale=1">

<style type="text/css">
@font-face {
font-family: octicons-link;
src: url(data:font/woff;charset=utf-8;base64,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) format('woff');
}
body {
-webkit-text-size-adjust: 100%;
text-size-adjust: 100%;
color: #333;
font-family: "Helvetica Neue", Helvetica, "Segoe UI", Arial, freesans, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
font-size: 16px;
line-height: 1.6;
word-wrap: break-word;
}
a {
background-color: transparent;
}
a:active,
a:hover {
outline: 0;
}
strong {
font-weight: bold;
}
h1 {
font-size: 2em;
margin: 0.67em 0;
}
img {
border: 0;
}
hr {
box-sizing: content-box;
height: 0;
}
pre {
overflow: auto;
}
code,
kbd,
pre {
font-family: monospace, monospace;
font-size: 1em;
}
input {
color: inherit;
font: inherit;
margin: 0;
}
html input[disabled] {
cursor: default;
}
input {
line-height: normal;
}
input[type="checkbox"] {
box-sizing: border-box;
padding: 0;
}
table {
border-collapse: collapse;
border-spacing: 0;
}
td,
th {
padding: 0;
}
* {
box-sizing: border-box;
}
input {
font: 13px / 1.4 Helvetica, arial, nimbussansl, liberationsans, freesans, clean, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
}
a {
color: #4078c0;
text-decoration: none;
}
a:hover,
a:active {
text-decoration: underline;
}
hr {
height: 0;
margin: 15px 0;
overflow: hidden;
background: transparent;
border: 0;
border-bottom: 1px solid #ddd;
}
hr:before {
display: table;
content: "";
}
hr:after {
display: table;
clear: both;
content: "";
}
h1,
h2,
h3,
h4,
h5,
h6 {
margin-top: 15px;
margin-bottom: 15px;
line-height: 1.1;
}
h1 {
font-size: 30px;
}
h2 {
font-size: 21px;
}
h3 {
font-size: 16px;
}
h4 {
font-size: 14px;
}
h5 {
font-size: 12px;
}
h6 {
font-size: 11px;
}
blockquote {
margin: 0;
}
ul,
ol {
padding: 0;
margin-top: 0;
margin-bottom: 0;
}
ol ol,
ul ol {
list-style-type: lower-roman;
}
ul ul ol,
ul ol ol,
ol ul ol,
ol ol ol {
list-style-type: lower-alpha;
}
dd {
margin-left: 0;
}
code {
font-family: Consolas, "Liberation Mono", Menlo, Courier, monospace;
font-size: 12px;
}
pre {
margin-top: 0;
margin-bottom: 0;
font: 12px Consolas, "Liberation Mono", Menlo, Courier, monospace;
}
.select::-ms-expand {
opacity: 0;
}
.octicon {
font: normal normal normal 16px/1 octicons-link;
display: inline-block;
text-decoration: none;
text-rendering: auto;
-webkit-font-smoothing: antialiased;
-moz-osx-font-smoothing: grayscale;
-webkit-user-select: none;
-moz-user-select: none;
-ms-user-select: none;
user-select: none;
}
.octicon-link:before {
content: '\f05c';
}
.markdown-body:before {
display: table;
content: "";
}
.markdown-body:after {
display: table;
clear: both;
content: "";
}
.markdown-body>*:first-child {
margin-top: 0 !important;
}
.markdown-body>*:last-child {
margin-bottom: 0 !important;
}
a:not([href]) {
color: inherit;
text-decoration: none;
}
.anchor {
display: inline-block;
padding-right: 2px;
margin-left: -18px;
}
.anchor:focus {
outline: none;
}
h1,
h2,
h3,
h4,
h5,
h6 {
margin-top: 1em;
margin-bottom: 16px;
font-weight: bold;
line-height: 1.4;
}
h1 .octicon-link,
h2 .octicon-link,
h3 .octicon-link,
h4 .octicon-link,
h5 .octicon-link,
h6 .octicon-link {
color: #000;
vertical-align: middle;
visibility: hidden;
}
h1:hover .anchor,
h2:hover .anchor,
h3:hover .anchor,
h4:hover .anchor,
h5:hover .anchor,
h6:hover .anchor {
text-decoration: none;
}
h1:hover .anchor .octicon-link,
h2:hover .anchor .octicon-link,
h3:hover .anchor .octicon-link,
h4:hover .anchor .octicon-link,
h5:hover .anchor .octicon-link,
h6:hover .anchor .octicon-link {
visibility: visible;
}
h1 {
padding-bottom: 0.3em;
font-size: 2.25em;
line-height: 1.2;
border-bottom: 1px solid #eee;
}
h1 .anchor {
line-height: 1;
}
h2 {
padding-bottom: 0.3em;
font-size: 1.75em;
line-height: 1.225;
border-bottom: 1px solid #eee;
}
h2 .anchor {
line-height: 1;
}
h3 {
font-size: 1.5em;
line-height: 1.43;
}
h3 .anchor {
line-height: 1.2;
}
h4 {
font-size: 1.25em;
}
h4 .anchor {
line-height: 1.2;
}
h5 {
font-size: 1em;
}
h5 .anchor {
line-height: 1.1;
}
h6 {
font-size: 1em;
color: #777;
}
h6 .anchor {
line-height: 1.1;
}
p,
blockquote,
ul,
ol,
dl,
table,
pre {
margin-top: 0;
margin-bottom: 16px;
}
hr {
height: 4px;
padding: 0;
margin: 16px 0;
background-color: #e7e7e7;
border: 0 none;
}
ul,
ol {
padding-left: 2em;
}
ul ul,
ul ol,
ol ol,
ol ul {
margin-top: 0;
margin-bottom: 0;
}
li>p {
margin-top: 16px;
}
dl {
padding: 0;
}
dl dt {
padding: 0;
margin-top: 16px;
font-size: 1em;
font-style: italic;
font-weight: bold;
}
dl dd {
padding: 0 16px;
margin-bottom: 16px;
}
blockquote {
padding: 0 15px;
color: #777;
border-left: 4px solid #ddd;
}
blockquote>:first-child {
margin-top: 0;
}
blockquote>:last-child {
margin-bottom: 0;
}
table {
display: block;
width: 100%;
overflow: auto;
word-break: normal;
word-break: keep-all;
}
table th {
font-weight: bold;
}
table th,
table td {
padding: 6px 13px;
border: 1px solid #ddd;
}
table tr {
background-color: #fff;
border-top: 1px solid #ccc;
}
table tr:nth-child(2n) {
background-color: #f8f8f8;
}
img {
max-width: 100%;
box-sizing: content-box;
background-color: #fff;
}
code {
padding: 0;
padding-top: 0.2em;
padding-bottom: 0.2em;
margin: 0;
font-size: 85%;
background-color: rgba(0,0,0,0.04);
border-radius: 3px;
}
code:before,
code:after {
letter-spacing: -0.2em;
content: "\00a0";
}
pre>code {
padding: 0;
margin: 0;
font-size: 100%;
word-break: normal;
white-space: pre;
background: transparent;
border: 0;
}
.highlight {
margin-bottom: 16px;
}
.highlight pre,
pre {
padding: 16px;
overflow: auto;
font-size: 85%;
line-height: 1.45;
background-color: #f7f7f7;
border-radius: 3px;
}
.highlight pre {
margin-bottom: 0;
word-break: normal;
}
pre {
word-wrap: normal;
}
pre code {
display: inline;
max-width: initial;
padding: 0;
margin: 0;
overflow: initial;
line-height: inherit;
word-wrap: normal;
background-color: transparent;
border: 0;
}
pre code:before,
pre code:after {
content: normal;
}
kbd {
display: inline-block;
padding: 3px 5px;
font-size: 11px;
line-height: 10px;
color: #555;
vertical-align: middle;
background-color: #fcfcfc;
border: solid 1px #ccc;
border-bottom-color: #bbb;
border-radius: 3px;
box-shadow: inset 0 -1px 0 #bbb;
}
.pl-c {
color: #969896;
}
.pl-c1,
.pl-s .pl-v {
color: #0086b3;
}
.pl-e,
.pl-en {
color: #795da3;
}
.pl-s .pl-s1,
.pl-smi {
color: #333;
}
.pl-ent {
color: #63a35c;
}
.pl-k {
color: #a71d5d;
}
.pl-pds,
.pl-s,
.pl-s .pl-pse .pl-s1,
.pl-sr,
.pl-sr .pl-cce,
.pl-sr .pl-sra,
.pl-sr .pl-sre {
color: #183691;
}
.pl-v {
color: #ed6a43;
}
.pl-id {
color: #b52a1d;
}
.pl-ii {
background-color: #b52a1d;
color: #f8f8f8;
}
.pl-sr .pl-cce {
color: #63a35c;
font-weight: bold;
}
.pl-ml {
color: #693a17;
}
.pl-mh,
.pl-mh .pl-en,
.pl-ms {
color: #1d3e81;
font-weight: bold;
}
.pl-mq {
color: #008080;
}
.pl-mi {
color: #333;
font-style: italic;
}
.pl-mb {
color: #333;
font-weight: bold;
}
.pl-md {
background-color: #ffecec;
color: #bd2c00;
}
.pl-mi1 {
background-color: #eaffea;
color: #55a532;
}
.pl-mdr {
color: #795da3;
font-weight: bold;
}
.pl-mo {
color: #1d3e81;
}
kbd {
display: inline-block;
padding: 3px 5px;
font: 11px Consolas, "Liberation Mono", Menlo, Courier, monospace;
line-height: 10px;
color: #555;
vertical-align: middle;
background-color: #fcfcfc;
border: solid 1px #ccc;
border-bottom-color: #bbb;
border-radius: 3px;
box-shadow: inset 0 -1px 0 #bbb;
}
.task-list-item {
list-style-type: none;
}
.task-list-item+.task-list-item {
margin-top: 3px;
}
.task-list-item input {
margin: 0 0.35em 0.25em -1.6em;
vertical-align: middle;
}
:checked+.radio-label {
z-index: 1;
position: relative;
border-color: #4078c0;
}
.sourceLine {
display: inline-block;
}
code .kw { color: #000000; }
code .dt { color: #ed6a43; }
code .dv { color: #009999; }
code .bn { color: #009999; }
code .fl { color: #009999; }
code .ch { color: #009999; }
code .st { color: #183691; }
code .co { color: #969896; }
code .ot { color: #0086b3; }
code .al { color: #a61717; }
code .fu { color: #63a35c; }
code .er { color: #a61717; background-color: #e3d2d2; }
code .wa { color: #000000; }
code .cn { color: #008080; }
code .sc { color: #008080; }
code .vs { color: #183691; }
code .ss { color: #183691; }
code .im { color: #000000; }
code .va {color: #008080; }
code .cf { color: #000000; }
code .op { color: #000000; }
code .bu { color: #000000; }
code .ex { color: #000000; }
code .pp { color: #999999; }
code .at { color: #008080; }
code .do { color: #969896; }
code .an { color: #008080; }
code .cv { color: #008080; }
code .in { color: #008080; }
</style>
<style>
body {
  box-sizing: border-box;
  min-width: 200px;
  max-width: 980px;
  margin: 0 auto;
  padding: 45px;
  padding-top: 0px;
}
</style>

</head>

<body>

<!-- README.md is generated from README.Rmd. Please edit that file -->

<h1 id="code-implementation-of-the-subsampling-algorithms">Code implementation of the subsampling algorithms.</h1>
<h2 id="introduction">Introduction</h2>
<p>We implemented 3 algorithms, defined “Distance procedure”, the “Probability procedure”, and the “Uniformity procedure” with the aim of producing sub-samples with specific distributional properties starting from an initial, collection of data which is possibly biased in terms of generalizability to a target population. In the following document we present the R code to implement the algorithms. The specific implementation described here is focused on the Italian PPS study on HAI/AMU prevalence in acute care hospitals but can easily translated to different settings.</p>
<p>The methods try to change the distributional characteristics of a sample by producing a sub-sample whose units are chosen according to some characteristics of interest. Two of these methods, the Distance procedure and the Probability procedure, are aimed at generating a representative sample of a target population, by using reference data at the population level with information on the distribution of relevant characteristics of the observational units. The Uniformity procedure instead generate a sample which is uniform in relation to such characteristics, therefore it does not require population reference data.</p>
<p>This document and all the relative material is available at <a href="https://github.com/AD-Papers-Material/SubsamplingMethods">https://github.com/AD-Papers-Material/SubsamplingMethods</a>.</p>
<h2 id="input-data">Input data</h2>
<p>The algorithms take as input a database with a statistical unit for each row and the characteristics of interest as columns. Furthermore, a column with an unique ID for each unit is useful for post-hoc checks and mandatory for the Distance procedure. Our algorithms also accept the Quality Score (<embed src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABoAAAARBAMAAAAxo6E+AAAAMFBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAv3aB7AAAAD3RSTlMAEHZmmbsi74lEVDLdq82NUXSoAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAt0lEQVQIHU2OwQoBYRSFPwz+GWSytDHZKk3KnjfwCFMWHsDKQokNVnZW4gns7Ck70ZQNb8Fa4Rgpf/33nu90bvcCsXKtCdjDUVut7tJxYYrdA9OKvt2ALczlOzcsHwbQVTjzIBlCgLmJnDvOsyKRbalYsjavHeS9j6UY9hFKK4lloBnWkPZFezIzWGgkLFSskLgiV9118BMXPgsSnlLmXA1SGDOeCPRyFL8iqlm38U8n74/i/R+8AVzrIxJf8bGFAAAAAElFTkSuQmCC" title="QS"></embed>, cfr. Methods) as additional characteristics, but they can be easily modified to remove such feature.</p>
<p>The Probability and the Distance procedures also requires population level reference data, with the same structure. If individual level data is not available at the population, simulated data can be generated given access to the joint distribution of the considered characteristics, ensuring that the simulated dataset is large enough to limit random variation.</p>
<p>Our test case data use acute care hospitals as observational units and hospital size (number of acute care beds) and region of location as characteristics of interest. As a reference, the hospital are also grouped in three hospital size categories; the same categorization is used in the manuscript. We provide simulated sample data for the testing of the procedures at <a href="https://github.com/AD-Papers-Material/SubsamplingMethods">https://github.com/AD-Papers-Material/SubsamplingMethods</a>.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a></span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="kw">str</span>(Sample.Data) <span class="co"># Simulated sample data retaining the real sample characteristics</span></span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="co">#&gt; &#39;data.frame&#39;:    143 obs. of  5 variables:</span></span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="co">#&gt;  $ Region: chr  &quot;regione piemonte&quot; &quot;regione piemonte&quot; &quot;regione piemonte&quot; &quot;regione piemonte&quot; ...</span></span>
<span id="cb1-5"><a href="#cb1-5"></a><span class="co">#&gt;  $ Beds  : int  183 172 157 179 85 133 189 182 185 71 ...</span></span>
<span id="cb1-6"><a href="#cb1-6"></a><span class="co">#&gt;  $ QS    : num  100.8 628.2 147 108.7 23.3 ...</span></span>
<span id="cb1-7"><a href="#cb1-7"></a><span class="co">#&gt;  $ Class : chr  &quot;&lt; 200&quot; &quot;&lt; 200&quot; &quot;&lt; 200&quot; &quot;&lt; 200&quot; ...</span></span>
<span id="cb1-8"><a href="#cb1-8"></a><span class="co">#&gt;  $ Code  : int  1 2 3 4 5 6 7 8 9 10 ...</span></span>
<span id="cb1-9"><a href="#cb1-9"></a></span>
<span id="cb1-10"><a href="#cb1-10"></a><span class="kw">str</span>(Reference.Data) <span class="co"># Official list of Italian acute hospitals, updated to 2016</span></span>
<span id="cb1-11"><a href="#cb1-11"></a><span class="co">#&gt; &#39;data.frame&#39;:    963 obs. of  4 variables:</span></span>
<span id="cb1-12"><a href="#cb1-12"></a><span class="co">#&gt;  $ Code  : int  10007 10010 10012 10612 10653 10655 10003 10011 10013 10611 ...</span></span>
<span id="cb1-13"><a href="#cb1-13"></a><span class="co">#&gt;  $ Beds  : int  258 73 22 105 9 96 337 368 95 115 ...</span></span>
<span id="cb1-14"><a href="#cb1-14"></a><span class="co">#&gt;  $ Class : chr  &quot;200 - 500&quot; &quot;&lt; 200&quot; &quot;&lt; 200&quot; &quot;&lt; 200&quot; ...</span></span>
<span id="cb1-15"><a href="#cb1-15"></a><span class="co">#&gt;  $ Region: chr  &quot;regione piemonte&quot; &quot;regione piemonte&quot; &quot;regione piemonte&quot; &quot;regione piemonte&quot; ...</span></span></code></pre></div>
<h2 id="general-aspects-and-notation">General aspects and notation</h2>
<p>The procedures at the moment can utilize only categorical characteristics/features of a sample. Therefore continuous characteristics (specifically, hospital size in this case) are discretized in quantiles by the algorithms before use. The number of quantiles to split continuous features into is an input to the algorithms. The hospitals are then grouped into <em>blocks</em> according to the characteristics of interest: in this study, we used <em>location/hospital size blocks</em>, defined by the Italian region (<embed src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADkAAAARBAMAAACVyRntAAAAMFBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAv3aB7AAAAD3RSTlMAid2ZuxCrzWZUMiJ270Sf5u5eAAAACXBIWXMAAA7EAAAOxAGVKw4bAAABJklEQVQYGXWPPUjDUBRGT1Nr82frD0jFxdkpRRe3ugguklGH0owODhl1i0IrgkNRpEE6xNFBrJNbyKaLkFEcRNzVQHFpF9+bkhS80znfd+G9C8wPFzZt/psph6Kblp8pSqp6aKM0ClOUdD/A/M1HGXuBppfxPG6xtwPaWUSp1rZvLegfB9rzbieQe0N/XXz5gG8e7Wa7+0YxMuLwztMaotTHmC7qCsscUQ2NhFMYdU8wHdGaMWqCsn3+UUn4omDxSmlEnelItPLcmNZA7LksMhMYY7n+TlVE8lzFLbUEFS0OuajoCeVIPNCriOwnoNwIlYBrzVHHzKms0kF1qatQWNtA3/eMJd+m1o+5ueLB9zA9SfkpOHnPm9LNe9ae6GV1gi/92YnkDx14S/0dMQ3DAAAAAElFTkSuQmCC" title="Region"></embed>) and the quantile of number of acute beds (<embed src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADQAAAANBAMAAAAUI1C9AAAAMFBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAv3aB7AAAAD3RSTlMAid2ZVBDvRLvNq3ZmMiIARFEQAAAACXBIWXMAAA7EAAAOxAGVKw4bAAABA0lEQVQYGVWQO0sDQRSFv4mbTDC7cVcXJChxEbSwyk8IWAkqEdLHIqAgwnRKKgsLK7W2sotgkzpB3CKQIs2UdqawFCKkEnzdjc3mNHPnPO4ZBlicVA82l0GvrL4zi/wF3AkVoo/QUVpc6MCXhCoQUTRp6dWif2AuBj/Ny/wM6hDy9zCSaxoP/7Tz+QTetsSbnsXpSw3HQbAWy/nyu0E9Zxme9+CRMyh+g9QJ9BZmnGyNcSPK4H5M65KeHVgSyxtkLocG5m/hSlpkbMGphC00xAg5H06gUIU2TmTYp0AjURibaZ283e2g/NjpDq7JWPZQN+1saWJQKpB/9MJaPbsu5nC39gdQrDtFelYT2wAAAABJRU5ErkJggg==" title="HSize"></embed>) the hospitals fall into. The region and the hospital size quantile allow the definition of a joint discrete probability distribution which is used by the algorithms. For each block <embed src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACwAAAAQBAMAAACfEoDkAAAAMFBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAv3aB7AAAAD3RSTlMAIqsyZrt270RUEIndzZm1YPYEAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAA/klEQVQYGWNg1BdgYNjzgAEGmOMXgJn2QJJ3AkyUgaEdwnQFUvwLEMKbIEw1INWDEGW4AmFXAKl9SMKfwWzGn9MmgFRwpmxmYJgyU4DjA7MbUIKlkKGK4SMDwzMGcQYmB6YN3AHG5kBhpg0MFRwFDCwXGPgNchk4F/BubljJMIWBvYHhM7cCA7sDw3qDL0Bl/BFAgoFhPQPnB14HBnkBBn/GX0B+v3UASFiGgSmBX9AA6KlrzB8YGBZsZTjBzKLAwMPQy7CehYHHAMg+yMAicIXhMKfDKQaOnQkM3B4MjDtdGBikZ3oxnGKYNoHxAsgcDMDtgCEEEuBZglWYzxEAzAY1dQH5/1EAAAAASUVORK5CYII=" title="block_i"></embed> a probability <embed src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQQAAAATBAMAAACEgm6uAAAAMFBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAv3aB7AAAAD3RSTlMAVHYiZpkQRO+Jq7vdMs3/9KjfAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAENUlEQVRIDYVVXWgcVRT+Zmd2Zv93ul371LRrqmgVZEAhtIidJjViFd1C1Ya+TLVoBWGnSDHFalcolT4EIqbg2lAGqQg+SFoD0ooYXyp9KJ0+iPVBskoR+iBdTRu1GPA7d5M6s9lkP8Ldc873zblnzpx7A/TCy70ESPZUrCxIrESlr4zs/WaRDJD/1ltJCExWkSU7efvk+VVUSF/ZZU6e8IHDm4fcSDazGnFi5gVgo6MiCT42GuPEOQK82g4WbFVCNkCy2Y7ISr4DXwOFAEjbGPWjdLlDd9e9BdRc5RW4fnw3vmQMAOfadtFTJRRdaAtLLEC+A38C1OAQkIvRkr8b8sw2aytGqrzeTbO4Id9XPsSsg8R8N9liTDIeZV93sxExGdvSFUYL2OMp6kuuc11E+Xo7eLJdwoPAAbeLbCmUYMaP6PAL60sx9WsFQGnTjmosSCczBWsMh9+c8FEHzbLong5h7BjS+h97Eler1ukbLvr7HOmQdOEC9n0FaNsrMCeGvavMSL123/6dIUmCGWV7bPyVAaH32D8rOTcw192S7hDJzwXjYqamBzd7WHspHWCGnRvDNJIVvY4yJvbV3OSwPYasy79MUzokJdwu7/WAT/AWnvAOCC/6gWuuxq0FqfONBgeMp+tfzyRtPHCuouRowbLqHDf54hFs8+lorx23HL3JSa7gOzwHLOB06PmjSH+mt1B08Awy43xaSsjPIdGEMYMP8QuKA+RFbz+LRMBMxLYQMg7EkcAircNoy3EcIvpUcZHlebHNNPuVb3KSHczjGMwFPP63jYeQqZLhQT2GlM8+SQmJOjg/ubODvtUiRV7pR5CpMBPBjDIOnAOtKTR0W8mBi0xg47227P/1C2XyyMOckWvBaOpzsge2tHAWKTsVsnMMzaLgqhKyvBbqqDncqEkqFbb170v5CsyYnQJ+5GQFpIF3eOwVV+c7etaMEVAXmYVL6rGax5+6XAtZt6/F71Gw6c7zYllv4brJ0MNW8dFQusAjn2uaNeqTVU7oeisvejZ8g8UYcYLjUAHu5WD68rjmoCJytcGsVwhddiMC/Q/lbJD1N7kWiq/4l7ETGViV/Dx+R8PA5QTq5g2jZqguHA1RmBrIhejTAmNO8dQbTYwY2Oqx7X+pcZBDMQihS2fedkQOnb25f/smyNBFcOqOLV6/LKz7ItJrsKXswjpYRmJ3ycFP61Bai0NrfhhOPyUlpF/YhfwZV/+g7GGiVBde9AlXrGsucOqO//rNl4DxRsMHg6b9xvdQcoPsNHjs+LsCtnbEeRg7wQ8RhUxoDOp9YpGIk/XaV19ufyQYN0USRdGJesruKCHXuWWnH0vAV+TccIaGYuGoo1ejHv8ZxF3xYiU8AjVCEZUWsZebLwLv/rM8HIscjHnWzfGYL06shHvKnYJVSzDCZemWB3ib9EC+B78azez/AfL+Ca9eYGPqAAAAAElFTkSuQmCC" title="p_{i} = Pr(hospital|Region, HSize)"></embed> is defined, either given a sample (<embed src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAAOBAMAAABjvHmeAAAAMFBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAv3aB7AAAAD3RSTlMAVHYiZpkQRO+Jq7vdMs3/9KjfAAAACXBIWXMAAA7EAAAOxAGVKw4bAAABC0lEQVQYGWNgEFJ2CWDACdjEvjCE4JRlYGdvYJjFIIKpoMIALMa0gGEppiQDAwdEkFuAoRGb9C2IIH8C+wGWBUC2owPDRBU2zcJgxwlJIZ4MSgxMQgkMDPcT+C44HGNg4J3gy31Bk4X/gjbDAYc2rgt7GZazFzAwqDoqMzA/AEr/unCHIZzhNsNytgO8G7gLGpg/CgHN3ALEnA5A4maDK8MxoJnHGANYFDhyNzCCg+MzUIYnhZnhFsMCSeZjAmvZDnCVcBV4skzkXcBwgYH3A1Ca1ZlbIaXkAqvgIoYNvBOYdHkcFZgDGaYAQ6PuJ1AaCAQgFITMQeaA2GxARyJAKYIJYTEiC7DtToByAXDeOpeOpeiYAAAAAElFTkSuQmCC" title="p_{i,sample}"></embed>) or the whole country (<embed src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAD8AAAAOBAMAAABqV9nkAAAAMFBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAv3aB7AAAAD3RSTlMAVHYiZpkQRO+Jq7vdMs3/9KjfAAAACXBIWXMAAA7EAAAOxAGVKw4bAAABD0lEQVQYGWNgEFJ2CWDAA9jEvjCE4JFnYGdvYJjFIIKuhA0hwLSAYSmCB2NxG8BYDNwCDI1wDpzBAWcx8CewH2BZAOSruDEoTmdZwHRNszCMN86BaaI7kHOBgeF+At8Fh2MMDFwC07kKeByO8ZnwX5jIoMQg0CsE5ABtUnVUZmB+wMBwB4T4mR9wMNxmWMuwl8F4A1AYZNMWIOZ0YGBwBaE6pgm3gbobgJBFgYFlwi2g5Gcg5klhZhBlSBdl2MspMElgLfvisgcOXAUMQA4DA+8HoAJWZ24FTkcBTqcLvOGuAhvYljAEXuAGygWeZWCo+wlUAAQCEAqNPADnsxXAmQiGNdAdMMAIYyDTLE4MDAAyoDeqJoJoxQAAAABJRU5ErkJggg==" title="p_{i,country}"></embed>) which indicate the fraction of hospital in a block over the total. All the algorithms are costrained by a parameter <embed src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAATBAMAAADSXRa0AAAAMFBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAv3aB7AAAAD3RSTlMAid0iEJm7RHbvq2YyVM2JF0xrAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAA/klEQVQoFWNgYBD6zMASn86AG3BMZWDgwi3NwMAtycDgjU/BGfsLDMX4FGzgS2BowKeggfcLAQUMPxg24DGBuYAhkt0AVcFtGJclA+gJBobz1TABDHo5AwMHAwPTCgwJmMAEsAKO3wwcstsZOG44MN4W2MXQw70Axr3xgIEBaDzLH4YLc24wLGcvyOGQZnJ4vEEFzhVgYJ10gYEhgME4gYH57w0eBdYLdgwTmB/AuQUwu7gbGHgDGLgDmBwaeRIYNyC4MAVcBQw8CxjOClgyyDL2MnnDuEa+MAVsQIb0bYbYVQxHq2NZN8O4txpgCmB0B4yBi87BJQEV552NrgAAxgtCTAG8MIcAAAAASUVORK5CYII=" title="N_{required}"></embed> which defines the size of the final sub-sample. As mentioned above, the algorithms may use the Quality Score <embed src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABoAAAARBAMAAAAxo6E+AAAAMFBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAv3aB7AAAAD3RSTlMAEHZmmbsi74lEVDLdq82NUXSoAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAt0lEQVQIHU2OwQoBYRSFPwz+GWSytDHZKk3KnjfwCFMWHsDKQokNVnZW4gns7Ck70ZQNb8Fa4Rgpf/33nu90bvcCsXKtCdjDUVut7tJxYYrdA9OKvt2ALczlOzcsHwbQVTjzIBlCgLmJnDvOsyKRbalYsjavHeS9j6UY9hFKK4lloBnWkPZFezIzWGgkLFSskLgiV9118BMXPgsSnlLmXA1SGDOeCPRyFL8iqlm38U8n74/i/R+8AVzrIxJf8bGFAAAAAElFTkSuQmCC" title="QS"></embed> as further discriminant in the selection; to avoid using the <embed src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABoAAAARBAMAAAAxo6E+AAAAMFBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAv3aB7AAAAD3RSTlMAEHZmmbsi74lEVDLdq82NUXSoAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAt0lEQVQIHU2OwQoBYRSFPwz+GWSytDHZKk3KnjfwCFMWHsDKQokNVnZW4gns7Ck70ZQNb8Fa4Rgpf/33nu90bvcCsXKtCdjDUVut7tJxYYrdA9OKvt2ALczlOzcsHwbQVTjzIBlCgLmJnDvOsyKRbalYsjavHeS9j6UY9hFKK4lloBnWkPZFezIzWGgkLFSskLgiV9118BMXPgsSnlLmXA1SGDOeCPRyFL8iqlm38U8n74/i/R+8AVzrIxJf8bGFAAAAAElFTkSuQmCC" title="QS"></embed> without code modification is sufficient to assign the same value (a positive number) to all hospitals. Note that lower <embed src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABoAAAARBAMAAAAxo6E+AAAAMFBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAv3aB7AAAAD3RSTlMAEHZmmbsi74lEVDLdq82NUXSoAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAt0lEQVQIHU2OwQoBYRSFPwz+GWSytDHZKk3KnjfwCFMWHsDKQokNVnZW4gns7Ck70ZQNb8Fa4Rgpf/33nu90bvcCsXKtCdjDUVut7tJxYYrdA9OKvt2ALczlOzcsHwbQVTjzIBlCgLmJnDvOsyKRbalYsjavHeS9j6UY9hFKK4lloBnWkPZFezIzWGgkLFSskLgiV9118BMXPgsSnlLmXA1SGDOeCPRyFL8iqlm38U8n74/i/R+8AVzrIxJf8bGFAAAAAElFTkSuQmCC" title="QS"></embed> implies better data quality.</p>
<h2 id="unformity-procedure">Unformity procedure</h2>
<p>This procedure sub-samples hospitals trying to obtain an equal proportion of hospitals in every block, by iteratively choosing one hospital from each block. This is the general implementation:</p>
<ul>
<li>a candidate list is created from the original sample;</li>
<li>the hospitals in the list are permuted randomly or ordered in ascending order by <embed src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABoAAAARBAMAAAAxo6E+AAAAMFBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAv3aB7AAAAD3RSTlMAEHZmmbsi74lEVDLdq82NUXSoAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAt0lEQVQIHU2OwQoBYRSFPwz+GWSytDHZKk3KnjfwCFMWHsDKQokNVnZW4gns7Ck70ZQNb8Fa4Rgpf/33nu90bvcCsXKtCdjDUVut7tJxYYrdA9OKvt2ALczlOzcsHwbQVTjzIBlCgLmJnDvOsyKRbalYsjavHeS9j6UY9hFKK4lloBnWkPZFezIzWGgkLFSskLgiV9118BMXPgsSnlLmXA1SGDOeCPRyFL8iqlm38U8n74/i/R+8AVzrIxJf8bGFAAAAAElFTkSuQmCC" title="QS"></embed> (the lower the score, the higher the data quality);</li>
<li>the first hospital is selected;</li>
<li>all other hospitals belonging to the same block of the selected hospital are removed from the candidate list;</li>
<li>the process is repeated until there are still available blocks in the candidate list;</li>
<li>once one hospital from each blocks has been chosen, the hospitals from all the blocks are made available again in the list, apart from those already selected in the sample;</li>
<li>continue until <embed src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAATBAMAAADSXRa0AAAAMFBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAv3aB7AAAAD3RSTlMAid0iEJm7RHbvq2YyVM2JF0xrAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAA/klEQVQoFWNgYBD6zMASn86AG3BMZWDgwi3NwMAtycDgjU/BGfsLDMX4FGzgS2BowKeggfcLAQUMPxg24DGBuYAhkt0AVcFtGJclA+gJBobz1TABDHo5AwMHAwPTCgwJmMAEsAKO3wwcstsZOG44MN4W2MXQw70Axr3xgIEBaDzLH4YLc24wLGcvyOGQZnJ4vEEFzhVgYJ10gYEhgME4gYH57w0eBdYLdgwTmB/AuQUwu7gbGHgDGLgDmBwaeRIYNyC4MAVcBQw8CxjOClgyyDL2MnnDuEa+MAVsQIb0bYbYVQxHq2NZN8O4txpgCmB0B4yBi87BJQEV552NrgAAxgtCTAG8MIcAAAAASUVORK5CYII=" title="N_{required}"></embed> is reached.</li>
</ul>
<p>For the uniform procedure, we discretized the number of beds only into 4 quantiles since it was less relevant to build a precise discrete probability distribution.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a>subsample.uniform &lt;-<span class="st"> </span><span class="cf">function</span>(Input.Sample, n.required, <span class="dt">n.quantiles =</span> <span class="dv">4</span>, <span class="dt">use.QS =</span> T){</span>
<span id="cb2-2"><a href="#cb2-2"></a>    <span class="kw">library</span>(dplyr)</span>
<span id="cb2-3"><a href="#cb2-3"></a>    <span class="kw">library</span>(Hmisc)</span>
<span id="cb2-4"><a href="#cb2-4"></a>    </span>
<span id="cb2-5"><a href="#cb2-5"></a>    Hospitals &lt;-<span class="st"> </span>Input.Sample <span class="op">%&gt;%</span></span>
<span id="cb2-6"><a href="#cb2-6"></a><span class="st">        </span><span class="kw">transmute</span>(Code, Region, <span class="dt">Beds =</span> Hmisc<span class="op">::</span><span class="kw">cut2</span>(Beds, <span class="dt">g =</span> n.quantiles), <span class="dt">QS =</span> <span class="cf">if</span> (use.QS) QS <span class="cf">else</span> <span class="dv">1</span>) <span class="co"># Prepare data by discretizing continuous variables like the number of acute beds and by changing QS to a fixed value if not to be used</span></span>
<span id="cb2-7"><a href="#cb2-7"></a>    </span>
<span id="cb2-8"><a href="#cb2-8"></a>    Selected.hospitals &lt;-<span class="st"> </span><span class="kw">c</span>()</span>
<span id="cb2-9"><a href="#cb2-9"></a>    Candidates &lt;-<span class="st"> </span><span class="kw">data.frame</span>()</span>
<span id="cb2-10"><a href="#cb2-10"></a>    </span>
<span id="cb2-11"><a href="#cb2-11"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>n.required) { <span class="co"># Until n.required is reached..</span></span>
<span id="cb2-12"><a href="#cb2-12"></a>        <span class="cf">if</span> (<span class="kw">nrow</span>(Candidates) <span class="op">==</span><span class="st"> </span><span class="dv">0</span>) { <span class="co"># If the candidate list is empty, rebuilt it from the non-selected hospitals</span></span>
<span id="cb2-13"><a href="#cb2-13"></a>            Candidates &lt;-<span class="st"> </span>Hospitals <span class="op">%&gt;%</span></span>
<span id="cb2-14"><a href="#cb2-14"></a><span class="st">                </span><span class="kw">filter</span>(<span class="op">!</span>(Code <span class="op">%in%</span><span class="st"> </span>Selected.hospitals)) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># Remove already selected hospitals</span></span>
<span id="cb2-15"><a href="#cb2-15"></a><span class="st">                </span><span class="kw">sample_frac</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># Permute order, useful only if QS is not used</span></span>
<span id="cb2-16"><a href="#cb2-16"></a><span class="st">                </span><span class="kw">arrange</span>(QS)</span>
<span id="cb2-17"><a href="#cb2-17"></a>        }</span>
<span id="cb2-18"><a href="#cb2-18"></a>        </span>
<span id="cb2-19"><a href="#cb2-19"></a>        <span class="co"># Extract the first hospital of the temporary list and add it to the list of selected hospitals</span></span>
<span id="cb2-20"><a href="#cb2-20"></a>        Extracted.hospital &lt;-<span class="st"> </span>Candidates[<span class="dv">1</span>,]</span>
<span id="cb2-21"><a href="#cb2-21"></a>        Selected.hospitals &lt;-<span class="st"> </span><span class="kw">c</span>(Selected.hospitals, Extracted.hospital<span class="op">$</span>Code)</span>
<span id="cb2-22"><a href="#cb2-22"></a>        </span>
<span id="cb2-23"><a href="#cb2-23"></a>        <span class="co"># Remove from the temporary list all hospitals in the same location/size block of the extracted hospital</span></span>
<span id="cb2-24"><a href="#cb2-24"></a>        Candidates &lt;-<span class="st"> </span>Candidates <span class="op">%&gt;%</span></span>
<span id="cb2-25"><a href="#cb2-25"></a><span class="st">            </span><span class="kw">filter</span>(<span class="op">!</span>(Region <span class="op">%in%</span><span class="st"> </span>Extracted.hospital<span class="op">$</span>Region <span class="op">&amp;</span><span class="st"> </span>Beds <span class="op">%in%</span><span class="st"> </span>Extracted.hospital<span class="op">$</span>Beds))</span>
<span id="cb2-26"><a href="#cb2-26"></a>    }</span>
<span id="cb2-27"><a href="#cb2-27"></a>    </span>
<span id="cb2-28"><a href="#cb2-28"></a>    Input.Sample <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(Code <span class="op">%in%</span><span class="st"> </span>Selected.hospitals) <span class="co"># Filter the initial data by the selected hospital codes</span></span>
<span id="cb2-29"><a href="#cb2-29"></a>}</span>
<span id="cb2-30"><a href="#cb2-30"></a></span>
<span id="cb2-31"><a href="#cb2-31"></a><span class="co">## Esamples</span></span>
<span id="cb2-32"><a href="#cb2-32"></a><span class="co"># Create a subsample of 56 hospitals using the QS</span></span>
<span id="cb2-33"><a href="#cb2-33"></a><span class="co"># subsample.uniform(Sample.Data, n.required = 56)</span></span>
<span id="cb2-34"><a href="#cb2-34"></a></span>
<span id="cb2-35"><a href="#cb2-35"></a><span class="co"># The same but this time hospitals are chosen randomly</span></span>
<span id="cb2-36"><a href="#cb2-36"></a><span class="co"># subsample.uniform(Sample.Data, n.required = 56)</span></span></code></pre></div>
<h2 id="probability-procedure">Probability procedure</h2>
<p>This algorithm uses information from a population level list (Reference Data) to built a discrete probability distribution representative of the target population and then uses it to create a representative sub-sample. The hospitals are selected according to how representative is the block they belong to at the country level. The <embed src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABoAAAARBAMAAAAxo6E+AAAAMFBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAv3aB7AAAAD3RSTlMAEHZmmbsi74lEVDLdq82NUXSoAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAt0lEQVQIHU2OwQoBYRSFPwz+GWSytDHZKk3KnjfwCFMWHsDKQokNVnZW4gns7Ck70ZQNb8Fa4Rgpf/33nu90bvcCsXKtCdjDUVut7tJxYYrdA9OKvt2ALczlOzcsHwbQVTjzIBlCgLmJnDvOsyKRbalYsjavHeS9j6UY9hFKK4lloBnWkPZFezIzWGgkLFSskLgiV9118BMXPgsSnlLmXA1SGDOeCPRyFL8iqlm38U8n74/i/R+8AVzrIxJf8bGFAAAAAElFTkSuQmCC" title="QS"></embed> is used to weight such representativeness. The weight of the <embed src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABoAAAARBAMAAAAxo6E+AAAAMFBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAv3aB7AAAAD3RSTlMAEHZmmbsi74lEVDLdq82NUXSoAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAt0lEQVQIHU2OwQoBYRSFPwz+GWSytDHZKk3KnjfwCFMWHsDKQokNVnZW4gns7Ck70ZQNb8Fa4Rgpf/33nu90bvcCsXKtCdjDUVut7tJxYYrdA9OKvt2ALczlOzcsHwbQVTjzIBlCgLmJnDvOsyKRbalYsjavHeS9j6UY9hFKK4lloBnWkPZFezIzWGgkLFSskLgiV9118BMXPgsSnlLmXA1SGDOeCPRyFL8iqlm38U8n74/i/R+8AVzrIxJf8bGFAAAAAElFTkSuQmCC" title="QS"></embed> itself can be weighted.</p>
<ul>
<li>the blocks are identified in the Reference Data and for each block <embed src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAATUAAAAUBAMAAAAetrcQAAAAMFBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAv3aB7AAAAD3RSTlMAVHYiZpkQRO+Jq7vdMs3/9KjfAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAFBElEQVRIDcVUXWgcVRT+dmd2Zmd3Z3e6bvKi1W1aqVWQAQs1tpppkqb41yZSrSjIxN8KQqZINWp/VghCkcBGE2tiLatGRSWSVlHaUro+WB8kOH1Q0SrZlCL0QbqaNv5gwO/OJtmdzTYJvngS7p7vnO/ce+aecw/wX+XhRQNDizIWIKQX8NV2Hbw0cNwtuXLQT9q1WcKqfYkofxhw1Bb4MqJ906Ec3O8Az61psSo5j1WCJenRHAKTHjPI/brnxewGHp8xTni5MSBUKNPUfFkvaceBeI6fYqDbAcNnJWDNakv9TVhQLnrkONeheWHrgCMzxikvNwYEpss0iV/kl98BcrALiAEMn5PCnLZEZdyF/pvHTXE9VytqJhPekKjpuIngVC3ajE0nfZ8JbOPV+Wl9frg42gqEXvJon3AtVdcfpWdKWGv3crsO2GH5GT4ULAKv03IMkHwOPE+YXNna7rcugD5ik7nqgcbNyABqbyrH+NtdyK0tgYa1m3C6XT103kLDchNxy8vtGDo/BwIb01D622y9jvqqN5Fsax0pnRIZ9fLCNWddMBy43/gZSCWBMKDUXxQXupA88CHlA4/xcmvDawhsyA4hzyL04lOE0lIGKfR3dlmhNqMXUeZkRQpImF5ul1IP2sDbeBa32TuszrCLe3CztKcHV5ZODB8dHBQNrJ/8x1YYLq8+kkYkrTpI8OPVDHtadI9PFB+aBdIfQqvvtp+WCnxfaXyBLcA0Drm20w3tfakocroTkax4w+w3fRLBAuQ8XsUEXU4TZKZ9mobrS3s2sYFLHbo7pzJcggzcBc1E2AaCObxb4lWuUbMSzepyUWj2AA8t8H2ZmEIPlGls+NPgYZF2Nhlz6kHYEW+YuQUzYEzscLOjFoVrAGELXW4oy6v0hA0sWo69FiiA4ZAM4OvUaj5bmzsYeLHEq1xZ7RrCWgmZYCvkxXiTC9KkOByNRRxG2GDJhkDTuPeGmZsYbxl0mcygINLtRZOJrSL3mXf0MTmjwPcsYA4Mxx7u7flEBglbzcs5KqvasOKAnAt+t2bnffpDVrBvMwHZKPdbLEsIRQyFjBhvUWt5kaWNG4RTnJxXqTin0HSDislbxb1xdMUKShf5oXaOnEDeYdpn0cRbcmgE9rPp08AKIOKI8ICJtFIUHpHbuB13rVP0GQciTsw6FV+bcPvQAKM3SWAK2pw0GULl7QO/iKtJPOKM4Q5EoKb1KfyKQRljQWSU87JStERu+1zER9fFXCwP5ORJaFkr5vIitiCUtaT3WEE2MFtOjJBmiPDk8AsmxhBwsZ6HXLtxJURn/yT+E1IhjDMYwQncNEqzv7TaybcYgGCaC7/0FLRlaExZUHemENyWNPFDPZJXYNeyb9vQ7zA37d4O6MOW1Jey0Z/MQO+zpb5Wlkhoeg/wxt/Okxe2A9nBQQcMV4ynvmKHLGsDSOMY4DSwgE3if28we4Z3luGfnIac/ZHO2nJLlZmzo1p4b5Wi5SoR9UAV9sPPCEXjxR6VUIcn6nBCM14xRtR3nilYrD+Bn1+BonYFoJrwV184q3KLeQ1REbVgblKOw6BIdqglmtY2Glqzq2/fZIwqw+hwubPeMVaxlV+V2v2YPV4tvtxuxNXV/upcff6QDez9q2SqTcz7+D6w04fUC1kfFsCXW11qHqH2kTPb3F3eTnHK+py2nj13WeG4XET0RfwLus2yt2btZb7r/1H+BbbuNL+ZX+jKAAAAAElFTkSuQmCC" title="p_{i, country} = Pr(hospital|Region, HSize)"></embed> is computed as the proportion of hospitals in the block over the total;</li>
<li>these probabilities are assigned to the relative blocks in the sample;</li>
<li>a score is computer for each hospital <embed src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAkAAAAQBAMAAAA2ZkhwAAAAJFBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADHJj5lAAAAC3RSTlMAIu8QVESZq2bdiaoDY/wAAAAJcEhZcwAADsQAAA7EAZUrDhsAAABESURBVAgdY2BgYBACYgYGEzCJRIQkADmsAiVAkoNhCkiCeTOIZJkAItkSQCSnA4i0NgCRkSCCoQqIjQSVgSR7mwADAwABUwZabWIS0gAAAABJRU5ErkJggg==" title="j"></embed> as <embed src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAARQAAAAUCAMAAAB72TL/AAAAM1BMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADxgEwMAAAAEHRSTlMAZiJUic0yEN3vq0R2mbuvh9d0iAAAAAlwSFlzAAAOxAAADsQBlSsOGwAABFxJREFUWAnNWIuWqyAM5CWooNf//9o7Ewh1rXbd3scu56y1IcAkJJN0jflBI5VvAvNd594xd76jdKUTxuUwFdfNdVEqxZYlte85lGCd1dlUl1oAWJIbVPwTPksWFHmIb6EZ/HFZnrrErvSHm6pXAlXzVM+jjqd/rBmTwZKVkp8y5IZcidt7Ttk0DLo9pYdeaIbWz1wDY+yKxtSzBxOh2ANoN/9dr3JbPPw9p+S9jdWGVc3LLUKM3zizVHmoWvKU2LHFWAifIm6n979fVyWA95wSjpQC7+qOk3qnRuFaI0hnaWimCJ4J1niJOItBBW+9l89iAyI4h+yCZd5h4gY/+1Kctc/QsMGt0QngtVOOaEvxkaiHarhihdjrjkHigyC85JjfhnJMUeq64O3ihWkYtnCQmfmH6FngAAcd78ZgAjw4Q5AfpMTNzTL30aIw+bRhhxaaovS1Rw//l045omWKzGSEGhaKVcRKKWOnzqW6B3VpA6nuR/dbFQawPRQKd0boWOGcLfrETMzOWKINEmt98/127T2DzqkoSF4pVv2PkCB7VMKXTjmi5Um8ylppFKsVsYb3pi9mVD+Z3F4VqbJORWfcuE3gFl4zh+Rf2mIyLUvH1dtWLavG1VPIfr6ZP51BdLcol8FvD6fktY+G7hQta2u9DMUqRkwtRdKm1JklnOR+je/nCYJD4DCXNuNaRXOyzjKaauFPna5k8YvHyrPp3ztD873rpnvpc4I2Clh6TbGKESKW7TvPSn8XKxMItfbT2Z/shpg+mbZFqp8DAi5VN6WebUK/beUzp+CGkRJSGLtisZaJ6UM27BZLTCVkj74yLuTFAmLLdQLbdliPSNnBbK9naMtqMijFgQUaVjFCxLJsmQ0a2ggi5NdSr22mbzrSx+mygooZPhgZVahCI4KOQHt8UWB8NDb5xqn4fjIincJutCvOKHHZ8PRRusUBjTUsZk9QcKI3U/S/2EYOUj6UZrZ6lSdHgD4g3aOFJ9MQcOQmPZdiVbFxM3ZNY8QVWFIPRi3I6El2SI1TbhEV1BUvbRPqkee9si5JAhM3h04ks7xMjbKgctM6VYySEPJEeiKFAZUd4wzHrfhzgqRN6A2mMG8DO4LzcUSbF+/jAty1eVCsXRwnYZAw20LP8wtKKoY4XpHCPWLy+ZmvpXKhlyq9f0S8CJLas/CZB6SKOISeZp7wz9TbwoSEtZPn5fZ/PIHt09Otqkny0+itI8SSy5U7QoYi3OLhjgQKkbhgt4hsRpTk2eU0MNolrWVCNn0f2CWm/QTS9LkyNpPevxCG/vV4kL2ExIqQCGiR+WT7GJeMbpG/QBO7xAUkVX+OxsULE8CPz5ivj/v6zDiyfHwcalL/n8LH6RvflGROVfOwdRoWxadIPV0mQi3G+Qtrrne7minTc342k+wlh11t1uSlMcUnaiBMUUwvSsh+C5CtUIvIhIr2s//2vZv09rlrq++f4qyKty/dPnzy6dZ/WeHKpN/yjRxjpvoGowAAAABJRU5ErkJggg==" title="score_j = p_{j, country} (1-scaled.QS_j)^w"></embed> where:</li>
<li><embed src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAAOBAMAAABtFQfxAAAAMFBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAv3aB7AAAAD3RSTlMAVHYiZpkQRO+Jq7vdMs3/9KjfAAAACXBIWXMAAA7EAAAOxAGVKw4bAAABGUlEQVQYGX2Qv0rDUBTGf0nT/GmaGkUFQSFaHToUujkIUiVLnSL4ANFFcJAKTg4S38BCQehUB+kaqg/QwQe4DpkcFOoDFHRxEMwVScFKPw6c73fOB/dyYK7sB0yRvvjBwZQ9hhHRgfhvJswGape7DMbmPrO2y1UGYxNldiY0BjQEqH6oLjX3qB7dLITJG5V5CfASloR2eA23VrPHYzEc1r8sV/UU82k9BdjYKaPnXZyBrNE2kRMXhC1yW5ACPMjHSjW0IC3jteLEqmdiwi40nC68y4BJTQn0s8AWLWu1IC42TzV60LI8nJEMPNOnPUu7SnK+b3NSz6/I0yTLgstPGVhDkW1Cxd+JN+R4Ygm5OP3Hj/ou7j8BfI9vR0I72MmipmgAAAAASUVORK5CYII=" title="p_{j, country}"></embed> is the probability of the block of the hospital <embed src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAkAAAAQBAMAAAA2ZkhwAAAAJFBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADHJj5lAAAAC3RSTlMAIu8QVESZq2bdiaoDY/wAAAAJcEhZcwAADsQAAA7EAZUrDhsAAABESURBVAgdY2BgYBACYgYGEzCJRIQkADmsAiVAkoNhCkiCeTOIZJkAItkSQCSnA4i0NgCRkSCCoQqIjQSVgSR7mwADAwABUwZabWIS0gAAAABJRU5ErkJggg==" title="j"></embed> at the country level;</li>
<li><embed src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFQAAAATBAMAAAD8GDcmAAAAMFBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAv3aB7AAAAD3RSTlMAZiJUic0yEN3vq0R2u5miby3cAAAACXBIWXMAAA7EAAAOxAGVKw4bAAABu0lEQVQoFYWQP0gbURzHP3f5c0kuaoyFiFi4QaSblwbapZBIdRFEazs6XLuWNgdScHBw0lJoiV0culyh4npgh7pIxC7VWOIkiKDSzaVHHGyhQ3+v7Qt2UH/w7vf9vc/3/d7vHVyM+Jt/VfLIUWpu86sv6ePnfE6V/8VDXa0rYexjLkPcZT3UoJ3PtdpWYvzv2oCU3m9ne17LPRG2dKQMJ9JY77dz/FjLloi0GrDqcQDmn32jO0+s5zbZrSckBBbvQaNUEzaheNmnPO0pJYhh3vOBPVbocsjU7bAjlwmEvFb4OySPfvhKMur52UnuGk2xy7t7iTs35YCQXwq/Up9PATTh1k+3S+6Vwd4xJq2KOyyR9sA6E5PdUnPGJkVKDERD0n/ISUY8wJL3mC2qCizJSh3zVA4Eqk641ARYVbLNsDVoRTJbxK4t6NRqeKewBZmQGx4Z7HrKIZ/mRaUQ5Vgg5tWsR4a5yuxj+iqof9WPMVPBXiti3i/69rc7J/5wyECpwEbpeSH5Fsb6p3CojIyEWJ2u3HNVBJZ2JJyrfMIWO7UhrcVl+eW0Js+0uCx/CTRpaHFtrk9da9GGQ5ff9fpgqNqSp/sAAAAASUVORK5CYII=" title="scaled.QS_j"></embed> is the <embed src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABoAAAARBAMAAAAxo6E+AAAAMFBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAv3aB7AAAAD3RSTlMAEHZmmbsi74lEVDLdq82NUXSoAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAt0lEQVQIHU2OwQoBYRSFPwz+GWSytDHZKk3KnjfwCFMWHsDKQokNVnZW4gns7Ck70ZQNb8Fa4Rgpf/33nu90bvcCsXKtCdjDUVut7tJxYYrdA9OKvt2ALczlOzcsHwbQVTjzIBlCgLmJnDvOsyKRbalYsjavHeS9j6UY9hFKK4lloBnWkPZFezIzWGgkLFSskLgiV9118BMXPgsSnlLmXA1SGDOeCPRyFL8iqlm38U8n74/i/R+8AVzrIxJf8bGFAAAAAElFTkSuQmCC" title="QS"></embed> of the hospital <embed src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAkAAAAQBAMAAAA2ZkhwAAAAJFBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADHJj5lAAAAC3RSTlMAIu8QVESZq2bdiaoDY/wAAAAJcEhZcwAADsQAAA7EAZUrDhsAAABESURBVAgdY2BgYBACYgYGEzCJRIQkADmsAiVAkoNhCkiCeTOIZJkAItkSQCSnA4i0NgCRkSCCoQqIjQSVgSR7mwADAwABUwZabWIS0gAAAABJRU5ErkJggg==" title="j"></embed> after that all <embed src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABoAAAARBAMAAAAxo6E+AAAAMFBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAv3aB7AAAAD3RSTlMAEHZmmbsi74lEVDLdq82NUXSoAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAt0lEQVQIHU2OwQoBYRSFPwz+GWSytDHZKk3KnjfwCFMWHsDKQokNVnZW4gns7Ck70ZQNb8Fa4Rgpf/33nu90bvcCsXKtCdjDUVut7tJxYYrdA9OKvt2ALczlOzcsHwbQVTjzIBlCgLmJnDvOsyKRbalYsjavHeS9j6UY9hFKK4lloBnWkPZFezIzWGgkLFSskLgiV9118BMXPgsSnlLmXA1SGDOeCPRyFL8iqlm38U8n74/i/R+8AVzrIxJf8bGFAAAAAElFTkSuQmCC" title="QS"></embed> have been rescaled to the range [0,1], with 1 representing the worst quality score and 0 the best. <embed src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIEAAAAUBAMAAABYJUOTAAAAMFBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAv3aB7AAAAD3RSTlMAEHarRM1UZrsi790ymYmFLq+pAAAACXBIWXMAAA7EAAAOxAGVKw4bAAACK0lEQVQ4EaWRz2sTURDHP+tukm5MNosHL1UMsWoRlfgfBPUgLZXQg1IosnhILkK2VYiiiNWD3roXQQ9KvVg8ipeKgntQ9CIt9ODRQEEEta3iD4IenHltWiM11Dowb75v3ny/7808sPJs3AzX7sx/P7N8nhmPFG3Zs9+XcOzA+VDCdk31gDOsYG1LBK18n4LUGO5d8AL6SrJNqkwZd99PiX+xnN5obKeu75Z8ADabZHlZpYNCvynU5Zq4I/dTg9fyDM3xFroiiR0UPppCXZriaX31dMxVcDXHYclp/EOhXo+oViIKpyNOyHH1FBQqE4IWxKn51AZjRYZu2mlXSIZeaId2oyu0y3qznXdKgotCmFLWG8iM//AVkoMbGtsVvGGLXST9c9gNZwIu4EWC81L4WZyHuvSL4GV5g89z3RqFo9fFdFzu03t8lzhJuuRJ4VS1R3EM1jdJO02dQbIsUH7Ep1tj+xtwF9xPItRkmkSIJY0YLIWTSprhmeiItJiMcY1JHiedWYRti/Q6uVuxJVj2vY4QZq1CPAu7ZTglLsWGnvDl4Iv4qhU5xCNS0YR1MrUjBU9Ixordg3S/4EwD/cxRUlsF3YRNAdbc1w+rfDhSCblTGWGg8mrEO8sKztyHudEhIhrz8yWsbAB16XCpn98VOuOiJURjiQjGBKn/iz3ItqplhOb+263EOuPjwVbhS8jqFJ2glVlf3LvSdgEuGo50syHLDyFD/R+7Ehj2L4lyf/mGpi1AAAAAAElFTkSuQmCC" title="(1-scaled.QS_j)"></embed> reweighs the probability of being included of a hospital using the quality of the data;</li>
<li><embed src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA0AAAAIBAMAAADQCGj8AAAAMFBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAv3aB7AAAAD3RSTlMAMlSZEO8i3c1EdomrZrtpo7NTAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAQklEQVQIHWNgVGZgVnBNYHBiF2AV4JjAMCGfIZ+BK4GBYQ/DPQZeBgaGSoZTYPoLkJUI5IexBDFcANKT78rccmAAAGC1DLIvAY6OAAAAAElFTkSuQmCC" title="w"></embed> allows scaling the importance of the <embed src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABoAAAARBAMAAAAxo6E+AAAAMFBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAv3aB7AAAAD3RSTlMAEHZmmbsi74lEVDLdq82NUXSoAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAt0lEQVQIHU2OwQoBYRSFPwz+GWSytDHZKk3KnjfwCFMWHsDKQokNVnZW4gns7Ck70ZQNb8Fa4Rgpf/33nu90bvcCsXKtCdjDUVut7tJxYYrdA9OKvt2ALczlOzcsHwbQVTjzIBlCgLmJnDvOsyKRbalYsjavHeS9j6UY9hFKK4lloBnWkPZFezIzWGgkLFSskLgiV9118BMXPgsSnlLmXA1SGDOeCPRyFL8iqlm38U8n74/i/R+8AVzrIxJf8bGFAAAAAElFTkSuQmCC" title="QS"></embed> in the selection, with <embed src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAC8AAAAMBAMAAAAAMfkHAAAAMFBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAv3aB7AAAAD3RSTlMAMlSZEO8i3c1EdomrZrtpo7NTAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAlUlEQVQYGWNgwAJm3Z6ARZSBgbGBoQ2rBJ8Cw2KsEvwCDFOB+pQZmBVcE5BVyCcwyDswOLELsApwgCyzOQMEp4GM+UCJBIYJ+Qz5DFzoOoByDHsY7jHwAtUhQL4Ag74DA0Mlwyk0Cf4JDKpAZV+AUokg5XA7+C4wrAHyw1iCGC6AJOCA8wHYg5PvytxygAuCGVraExgANBojG9jIkWIAAAAASUVORK5CYII=" title="w = 0"></embed> removing its influence;</li>
<li>finally, <embed src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAC8AAAAOBAMAAABN+VgMAAAAMFBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAv3aB7AAAAD3RSTlMAZiJUic0yEN3vq0R2mbvQvSoYAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAA2ElEQVQYGWNgYBQUYmAWNmJgPujGsGWT4wYGQxsGMDBkcGRYyLCE4Q6DJoNRC8sCrgPcG8ASrgkFPAEM5owBDPzJ1dO5FSQYWBQY+IBSGj8N+AUYGDgFGOrTWS4wMPQZnoYYxaDyQb+AgUFfgUGegdWAgf0TVBjInpDPwMAOxDEM9QUM7B+AEoxuDAxcDNwHOBQYhDgSGBcwmAIF2xiYE8RNGBi4NxsyMDkbFjA5CzIwnAFKqBiLMxRcBjKwgiCsokDBCTgk2B7gkOA5gF2Ch1UBuwTfYQYGAMAXJdY6NYgsAAAAAElFTkSuQmCC" title="score_j"></embed> is used to order the hospitals and the first <embed src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAATBAMAAADSXRa0AAAAMFBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAv3aB7AAAAD3RSTlMAid0iEJm7RHbvq2YyVM2JF0xrAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAA/klEQVQoFWNgYBD6zMASn86AG3BMZWDgwi3NwMAtycDgjU/BGfsLDMX4FGzgS2BowKeggfcLAQUMPxg24DGBuYAhkt0AVcFtGJclA+gJBobz1TABDHo5AwMHAwPTCgwJmMAEsAKO3wwcstsZOG44MN4W2MXQw70Axr3xgIEBaDzLH4YLc24wLGcvyOGQZnJ4vEEFzhVgYJ10gYEhgME4gYH57w0eBdYLdgwTmB/AuQUwu7gbGHgDGLgDmBwaeRIYNyC4MAVcBQw8CxjOClgyyDL2MnnDuEa+MAVsQIb0bYbYVQxHq2NZN8O4txpgCmB0B4yBi87BJQEV552NrgAAxgtCTAG8MIcAAAAASUVORK5CYII=" title="N_{required}"></embed> get selected. In alternative, the score can be used as a weight for selecting the hospitals by random sampling.</li>
</ul>
<!-- end list -->

<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a></span>
<span id="cb3-2"><a href="#cb3-2"></a>subsample.probability &lt;-<span class="st"> </span><span class="cf">function</span>(Input.Sample, Reference.Data, n.required, <span class="dt">n.quantiles =</span> <span class="dv">10</span>, <span class="dt">QS.weight =</span> <span class="dv">1</span>, <span class="dt">method =</span> <span class="kw">c</span>(<span class="st">&#39;arrange&#39;</span>, <span class="st">&#39;random&#39;</span>)){</span>
<span id="cb3-3"><a href="#cb3-3"></a>    </span>
<span id="cb3-4"><a href="#cb3-4"></a>    <span class="kw">library</span>(dplyr)</span>
<span id="cb3-5"><a href="#cb3-5"></a>    <span class="kw">library</span>(Hmisc)</span>
<span id="cb3-6"><a href="#cb3-6"></a>    <span class="kw">library</span>(magrittr)</span>
<span id="cb3-7"><a href="#cb3-7"></a>    <span class="kw">library</span>(scales)</span>
<span id="cb3-8"><a href="#cb3-8"></a>    </span>
<span id="cb3-9"><a href="#cb3-9"></a>    method &lt;-<span class="st"> </span><span class="kw">match.arg</span>(method)</span>
<span id="cb3-10"><a href="#cb3-10"></a>    </span>
<span id="cb3-11"><a href="#cb3-11"></a>    <span class="co"># Definition of quantiles in the distribution of number of beds according to reference data</span></span>
<span id="cb3-12"><a href="#cb3-12"></a>    quantiles &lt;-<span class="st"> </span><span class="kw">quantile</span>(Reference.Data<span class="op">$</span>Beds, <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dt">length.out =</span> n.quantiles)) <span class="op">%&gt;%</span><span class="st"> </span>round</span>
<span id="cb3-13"><a href="#cb3-13"></a>    </span>
<span id="cb3-14"><a href="#cb3-14"></a>    P_country &lt;-<span class="st"> </span>Reference.Data <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb3-15"><a href="#cb3-15"></a><span class="st">        </span><span class="kw">count</span>(<span class="dt">Block =</span> Hmisc<span class="op">::</span><span class="kw">cut2</span>(Beds, quantiles) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">paste</span>(<span class="st">&#39;-&#39;</span>, Region)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb3-16"><a href="#cb3-16"></a><span class="st">        </span><span class="kw">mutate</span>(<span class="dt">Prob =</span> n <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(n)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb3-17"><a href="#cb3-17"></a><span class="st">        </span><span class="kw">with</span>(magrittr<span class="op">::</span><span class="kw">set_names</span>(Prob, Block))</span>
<span id="cb3-18"><a href="#cb3-18"></a>    </span>
<span id="cb3-19"><a href="#cb3-19"></a>    Selection &lt;-<span class="st"> </span>Input.Sample <span class="op">%&gt;%</span></span>
<span id="cb3-20"><a href="#cb3-20"></a><span class="st">        </span><span class="kw">mutate</span>(</span>
<span id="cb3-21"><a href="#cb3-21"></a>            <span class="dt">Block =</span> Hmisc<span class="op">::</span><span class="kw">cut2</span>(Beds, quantiles) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">paste</span>(<span class="st">&#39;-&#39;</span>, Region), <span class="co"># Identification of the country level blocks in the sample</span></span>
<span id="cb3-22"><a href="#cb3-22"></a>            <span class="dt">Prob =</span> P_country[Block], <span class="co"># Assoction of P_country to the hospital in the sample</span></span>
<span id="cb3-23"><a href="#cb3-23"></a>            <span class="dt">QS.rescale =</span> <span class="dv">1</span> <span class="op">-</span><span class="st"> </span>scales<span class="op">::</span><span class="kw">rescale</span>(QS), <span class="co"># Creation of the quality weight after rescaling of the QS</span></span>
<span id="cb3-24"><a href="#cb3-24"></a>            <span class="dt">Score =</span> Prob <span class="op">*</span><span class="st"> </span>QS.rescale<span class="op">^</span>QS.weight <span class="co"># Definition of the final score</span></span>
<span id="cb3-25"><a href="#cb3-25"></a>        ) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb3-26"><a href="#cb3-26"></a><span class="st">        </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(Score)) <span class="co"># Remove blocks that do not appear in the national list</span></span>
<span id="cb3-27"><a href="#cb3-27"></a>    </span>
<span id="cb3-28"><a href="#cb3-28"></a>    <span class="cf">if</span> (method <span class="op">==</span><span class="st"> &#39;arrange&#39;</span>) {</span>
<span id="cb3-29"><a href="#cb3-29"></a>        Selection <span class="op">%&gt;%</span></span>
<span id="cb3-30"><a href="#cb3-30"></a><span class="st">            </span><span class="kw">arrange</span>(<span class="kw">desc</span>(Score)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb3-31"><a href="#cb3-31"></a><span class="st">            </span><span class="kw">head</span>(n.required)</span>
<span id="cb3-32"><a href="#cb3-32"></a>    } <span class="cf">else</span> {</span>
<span id="cb3-33"><a href="#cb3-33"></a>        <span class="kw">slice_sample</span>(Selection, <span class="dt">n =</span> n.required, <span class="dt">weight_by =</span> Score)</span>
<span id="cb3-34"><a href="#cb3-34"></a>    }</span>
<span id="cb3-35"><a href="#cb3-35"></a>}</span></code></pre></div>

</body>
</html>
